var Searchbar=Class.extend({init:function(){if(this.searchbar=$("form.searchbar"),this.searchable=$("table.searchable"),0!=this.searchbar.length&&0!=this.searchable.length&&(this.search=$.proxy(this.search,this),this.reset=$.proxy(this.reset,this),this.fields=this.searchbar.find(":input").each(function(e,a){switch(a.type){case"text":$(a).keyup(this.search);break;case"select-one":$(a).change(this.search);break;case"checkbox":$(a).click(this.search);break;case"reset":$(a).click(this.reset)}}.bind(this)),$.url&&"function"==typeof $.url)){var e=$.url().param(),a=!1;for(var t in e){var r=e[t],s=this.searchbar.find("input[name="+t+"]");0!=s.length&&(a=!0,s.val(r))}if(a){this.search();var i=this.searchable.find("tbody tr:visible");if(1==i.length){var h=i.find("th a").get(0);this.searchable.trigger("click",[h])}}}},search:function(e){if(this.searchbar.trigger("searchbar:before",[e]),!(e&&e.isPropagationStopped&&e.isPropagationStopped())){var a=this.searchable.find("tbody tr").removeClass("hidden");a.each(function(e,a){var t=!0,r=$(a);this.fields.each(function(){var e=$(this),a=e.context.type;if("reset"!=a){var s="checkbox"==a?e.context.checked:e.val();if(s&&0!=s.length&&"all"!=s){var i=e.attr("id");if("text"!=a)t=r.data(i+"-list")?t&&r.is("[data-"+i+"-list~="+s+"]"):t&&r.data(i)==s;else try{var h=new RegExp(s.replace(/\(|\)/g,"_"),"i"),c=r.data(i).replace(/\(|\)/g,"_");t=t&&c.match(h)}catch(n){console.log(n)}}}}),t||r.addClass("hidden")}.bind(this)),this.searchbar.trigger("searchbar:after")}},reset:function(){return this.searchbar.closest("form").get(0).reset(),this.searchable.find("tbody tr.hidden").removeClass("hidden"),this.searchbar.trigger("searchbar:reset"),!1}});$(document).ready(function(){Searchbar=new Searchbar});